!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("SsitMobileEsign",[],e):"object"==typeof exports?exports.SsitMobileEsign=e():t.SsitMobileEsign=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=1)}([function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}e.a={props:{width:{type:Number,default:800},height:{type:Number,default:300},aspectRatio:{type:Number,default:function(){return null}},lineWidth:{type:Number,default:4},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""},isCrop:{type:Boolean,default:!1},targetWidth:{type:Number,default:-1},delayInitTime:{type:Number,default:function(){return 0}},maxHeightPercent:{type:Number,default:function(){return.6}},signImageMinSize:{type:Number,default:function(){return-1}}},data:function(){return{hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1,emptyData:null,emptySize:0}},computed:{ratio:function(){return this.aspectRatio>0?this.aspectRatio:this.height/this.width},stageInfo:function(){return this.$refs.canvas.getBoundingClientRect()},myBg:function(){return this.bgColor?this.bgColor:"rgba(255, 255, 255, 0)"}},watch:{myBg:function(t){this.$refs.canvas.style.background=t}},beforeMount:function(){window.addEventListener("resize",this.$_resizeHandler)},beforeDestroy:function(){window.removeEventListener("resize",this.$_resizeHandler)},mounted:function(){var t=this,e=this.canvasSize(),n=this.$refs.canvas;n.height=e.height,n.width=e.width,n.style.background=this.myBg,this.delayInitTime>0?setTimeout(function(){t.$_resizeHandler()},this.delayInitTime):this.$_resizeHandler(),document.onmouseup=function(){t.isDrawing=!1},this.emptyData=this.$refs.canvas.toDataURL(),this.compressImage(this.emptyData,this.targetWidth,"image/jpeg",function(e){t.emptySize=t.imageBlob(e).size,console.log("emptySize=",t.emptySize)})},methods:{$_resizeHandler:function(){var t=this,e=this.canvasSize();console.log(e);var n=e.width,i=this.$refs.canvas;i.style.width=n+"px",setTimeout(function(){var e=parseFloat(window.getComputedStyle(i).width);console.log("realw",e),i.style.height=t.ratio*e+"px",t.canvasTxt=i.getContext("2d"),t.canvasTxt.scale(1*t.sratio,1*t.sratio),t.sratio=e/i.width,t.canvasTxt.scale(1/t.sratio,1/t.sratio)},this.delayInitTime)},mouseDown:function(t){t=t||event,t.preventDefault(),this.isDrawing=!0,this.hasDrew=!0;var e={x:t.offsetX,y:t.offsetY};this.drawStart(e)},mouseMove:function(t){if(t=t||event,t.preventDefault(),this.isDrawing){var e={x:t.offsetX,y:t.offsetY};this.drawMove(e)}},mouseUp:function(t){t=t||event,t.preventDefault();var e={x:t.offsetX,y:t.offsetY};this.drawEnd(e),this.isDrawing=!1},touchStart:function(t){if(t=t||event,t.preventDefault(),t.touches.length>=1){this.hasDrew=!0;var e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawStart(e)}},touchMove:function(t){if(t=t||event,t.preventDefault(),t.touches.length>=1){var e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawMove(e)}},touchEnd:function(t){if(t=t||event,t.preventDefault(),t.touches.length>=1){var e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawEnd(e)}},drawStart:function(t){this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)},drawMove:function(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.strokeStyle=this.lineColor,this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd:function(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},generate:function(){var t=this,e=this;return new Promise(function(n,a){if(!t.hasDrew||t.emptyData==t.$refs.canvas.toDataURL())return void a({error:1,message:"未签字"});var s=parseFloat(window.getComputedStyle(t.$refs.canvas).width),r=parseFloat(window.getComputedStyle(t.$refs.canvas).height),o=t.canvasTxt.getImageData(0,0,s,r);t.canvasTxt.globalCompositeOperation="destination-over",t.canvasTxt.fillStyle=t.myBg,t.canvasTxt.fillRect(0,0,s,r),t.resultImg=t.$refs.canvas.toDataURL();var c=t.resultImg;if(t.canvasTxt.clearRect(0,0,s,r),t.canvasTxt.putImageData(o,0,0),t.canvasTxt.globalCompositeOperation="source-over",t.isCrop){var u,h=t.getCropArea(o.data),l=document.createElement("canvas"),d=l.getContext("2d");l.width=h[2]-h[0],l.height=h[3]-h[1];var f=(u=t.canvasTxt).getImageData.apply(u,i(h));d.globalCompositeOperation="destination-over",d.putImageData(f,0,0),d.fillStyle=t.myBg,d.fillRect(0,0,l.width,l.height),c=l.toDataURL(),l=null}if(e.targetWidth>0&&e.targetWidth<s)e.compressImage(c,e.targetWidth,"image/jpeg",function(t){var i=e.imageBlob(t);if(e.signImageMinSize>0&&e.signImageMinSize>i.size-e.emptySize)return void a({error:2,message:"签字不符合要求"});n({base64:t,blob:i})});else{var p=e.imageBlob(c);if(e.signImageMinSize>0&&e.signImageMinSize>p.size-e.emptySize)return void a({error:2,message:"签字不符合要求"});n({base64:c,blob:p})}})},compressImage:function(t,e,n,i){var a=new Image;a.src=t,a.onload=function(){var t=a.width,s=a.height,r=t/s;t=e||t,s=t/r;console.log(t,s);var o=document.createElement("canvas"),c=o.getContext("2d"),u=document.createAttribute("width");u.nodeValue=t;var h=document.createAttribute("height");h.nodeValue=s,o.setAttributeNode(u),o.setAttributeNode(h),c.drawImage(a,0,0,t,s),n=n||"image/jpeg";var l=o.toDataURL(n,.7);i(l)}},reset:function(){this.canvasTxt.clearRect(0,0,parseFloat(window.getComputedStyle(this.$refs.canvas).width),parseFloat(window.getComputedStyle(this.$refs.canvas).height)),this.$emit("update:bgColor",""),this.$refs.canvas.style.background=this.myBg,this.points=[],this.hasDrew=!1,this.resultImg=""},getCropArea:function(t){for(var e=this.$refs.canvas.width,n=0,i=this.$refs.canvas.height,a=0,s=0;s<this.$refs.canvas.width;s++)for(var r=0;r<this.$refs.canvas.height;r++){var o=4*(s+this.$refs.canvas.width*r);(t[o]>0||t[o+1]>0||t[o+2]||t[o+3]>0)&&(a=Math.max(r,a),n=Math.max(s,n),i=Math.min(r,i),e=Math.min(s,e))}return e++,n++,i++,a++,[e,i,n,a]},canvasSize:function(){var t=void 0,e=void 0,n=document.documentElement.clientWidth,i=document.documentElement.clientHeight;return this.aspectRatio>0?n*this.aspectRatio>i*this.maxHeightPercent?(e=i*this.maxHeightPercent,t=e/this.aspectRatio):(t=n,e=n*this.aspectRatio):(t=this.width,e=this.height),{width:t,height:e}},imageBlob:function(t){for(var e=window.atob(t.split(",")[1]),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2);e.default=i.a},function(t,e,n){"use strict";function i(t){n(3)}var a=n(0),s=n(9),r=n(8),o=i,c=r(a.a,s.a,!1,o,"data-v-f835d7ee",null);e.a=c.exports},function(t,e,n){var i=n(4);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n(6)("0e58f791",i,!0,{})},function(t,e,n){e=t.exports=n(5)(!1),e.push([t.i,"canvas[data-v-f835d7ee]{max-width:100%;display:block}",""])},function(t,e){function n(t,e){var n=t[1]||"",a=t[3];if(!a)return n;if(e&&"function"==typeof btoa){var s=i(a);return[n].concat(a.sources.map(function(t){return"/*# sourceURL="+a.sourceRoot+t+" */"})).concat([s]).join("\n")}return[n].join("\n")}function i(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=n(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},a=0;a<this.length;a++){var s=this[a][0];"number"==typeof s&&(i[s]=!0)}for(a=0;a<t.length;a++){var r=t[a];"number"==typeof r[0]&&i[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),e.push(r))}},e}},function(t,e,n){function i(t){for(var e=0;e<t.length;e++){var n=t[e],i=h[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(s(n.parts[a]));i.parts.length>n.parts.length&&(i.parts.length=n.parts.length)}else{for(var r=[],a=0;a<n.parts.length;a++)r.push(s(n.parts[a]));h[n.id]={id:n.id,refs:1,parts:r}}}}function a(){var t=document.createElement("style");return t.type="text/css",l.appendChild(t),t}function s(t){var e,n,i=document.querySelector("style["+m+'~="'+t.id+'"]');if(i){if(p)return v;i.parentNode.removeChild(i)}if(y){var s=f++;i=d||(d=a()),e=r.bind(null,i,s,!1),n=r.bind(null,i,s,!0)}else i=a(),e=o.bind(null,i),n=function(){i.parentNode.removeChild(i)};return e(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;e(t=i)}else n()}}function r(t,e,n,i){var a=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=x(e,a);else{var s=document.createTextNode(a),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function o(t,e){var n=e.css,i=e.media,a=e.sourceMap;if(i&&t.setAttribute("media",i),g.ssrId&&t.setAttribute(m,e.id),a&&(n+="\n/*# sourceURL="+a.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var c="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!c)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=n(7),h={},l=c&&(document.head||document.getElementsByTagName("head")[0]),d=null,f=0,p=!1,v=function(){},g=null,m="data-vue-ssr-id",y="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n,a){p=n,g=a||{};var s=u(t,e);return i(s),function(e){for(var n=[],a=0;a<s.length;a++){var r=s[a],o=h[r.id];o.refs--,n.push(o)}e?(s=u(t,e),i(s)):s=[];for(var a=0;a<n.length;a++){var o=n[a];if(0===o.refs){for(var c=0;c<o.parts.length;c++)o.parts[c]();delete h[o.id]}}}};var x=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var n=[],i={},a=0;a<e.length;a++){var s=e[a],r=s[0],o=s[1],c=s[2],u=s[3],h={id:t+":"+a,css:o,media:c,sourceMap:u};i[r]?i[r].parts.push(h):n.push(i[r]={id:r,parts:[h]})}return n}},function(t,e){t.exports=function(t,e,n,i,a,s){var r,o=t=t||{},c=typeof t.default;"object"!==c&&"function"!==c||(r=t,o=t.default);var u="function"==typeof o?o.options:o;e&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0),n&&(u.functional=!0),a&&(u._scopeId=a);var h;if(s?(h=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=h):i&&(h=i),h){var l=u.functional,d=l?u.render:u.beforeCreate;l?(u._injectStyles=h,u.render=function(t,e){return h.call(e),d(t,e)}):u.beforeCreate=d?[].concat(d,h):[h]}return{esModule:r,exports:o,options:u}}},function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement;return(t._self._c||e)("canvas",{ref:"canvas",staticStyle:{margin:"0 auto"},on:{mousedown:t.mouseDown,mousemove:t.mouseMove,mouseup:t.mouseUp,touchstart:t.touchStart,touchmove:t.touchMove,touchend:t.touchEnd}})},a=[],s={render:i,staticRenderFns:a};e.a=s}])});
//# sourceMappingURL=index.js.map